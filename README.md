# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Товар

```
interface IProduct {
  id: string;
  description?: string;
  image: string;
  title: string;
  category: string;
  price: number | null;
}
```

Покупатель

```
interface ICustomer {
  deliveryAddress: string;
  paymentMethod: string;
  emailAddress: string;
  phoneNumber: string
}
```

Коллекция товаров 

```
interface IProductList {
  products: IProduct[];
  preview: string | null;
  getProductList(): IProduct[];
}
```

Корзина

```
interface IBasket {
  products: IProduct[];
  total: number;
  addProduct(product: IProduct): void;
  removeProduct(productId: string): void;
  getBasketList(): IProduct[];
  totalAmount(): number;
  clearBasket(): void;
}
```

Методы для работы с данными покупателя

```
interface ICustomerInfo {
  getCustomerInfo(): ICustomer;
  setCustomerInfo(customerData: ICustomer): void;
  checkCustomerValidation(data: Record<keyof ICustomer, string>): boolean;
}
```

Данные покупателя, использумые в форме при оформлении заказа

```
type TCustomerOderData = Pick<ICustomer, 'paymentMethod' | 'deliveryAddress'>;
```

```
type TCustomerPrivateData = Pick<ICustomer, 'emailAddress' | 'phoneNumber'>
```

Основые данные товара, используемые в корзине

```
type TProductMainData = Pick<IProduct, 'id' | 'title' | 'price'>
```

## Архитектура приложения

Код приложения разделён на слои согласно парадигме MVP:
- слой данных, отвечает за хранение и изменение данных,
- слой представления, отвечает за отображение данных на странице,
- презентер, отвечает за связь представления и данных

### Базовый код

#### Класс Api
Предназначен для взаимодействия с REST API.\
Он позваляет отправить HHTP-запрос с поддержкой методов `GET` и `POST` по умолчанию, но при желании метод `POST` можно переопределить на `PUT` и `DELETE` при помощи передачи третьего аргумента при вызове.

#### Класс EventEmitter 
Предоставляет систему для регистрации, управления и вызова событий в приложении. Это позволяет добавлять слушателей событий (подписчиков) на определённые события и затем вызывать эти события с передачей данных (если нужно).\
Возможности:
- `on` - подписывается на событие
- `emit` - инициализирует событие
- `trigger` - возвращает функцию, которая может генерировать событие с заранее заданным контекстом

### Слой данных

#### Класс ProductsData
Класс отвечает за хранение и логику работы с данными товаров.\
В полях класса содержатся следующие данные:
- products: IProduct[] - массив объектов товаров
- preview: string | null - id товара, выбранный для просмотра в модальном окне\
- events: IEvents - экземпляр класса `EventEmiter` для инициализаций событий при изменении данных.

Также класс предоставляет набор методов для взаимодействия с этими данными:
- getProductList(): IProduct[] - возвращает массив объектов товаров

#### Класс СustomerData 
Класс отвечает за хранение и логику работы с данными покупателя.\
В полях класса содержатся следующие данные:
- deliveryAddress: string - адрес доставки
- paymentMethod: string - способ оплаты
- emailAddress: string - почта
- phoneNumber: string - номер телефона
- events: IEvents - экземпляр класса `EventEmiter` для инициализаций событий при изменении данных.

Также класс предоставляет набор методов для взаимодействия с этими данными:
- getCustomerInfo(): ICustomer - возвращает данные покупателя
- setCustomerInfo(customerData: ICustomer): void - обновляет данные покупателя
- checkCustomerValidation(data: Record<keyof ICustomer, string>): boolean - проверяет ведённые данные покупателя

#### Класс BasketData 
Класс отвечает за хранение и логику работы с данными товаров в корзине.\
В полях класса содержатся следующие данные:
- products: IProduct[] - хранит массив объектов товара в корзине
- total: number - хранит полную стоимость оплаты
- events: IEvents - экземпляр класса `EventEmiter` для инициализаций событий при изменении данных.

Также класс предоставляет набор методов для взаимодействия с этими данными:
- addProduct(product: IProduct): - добавляет один товар в корзину
- removeProduct(productId: string): - удаляет один товар из корзины
- getBasketList(): IProduct[] - возвращает массив объектов товара в корзине
- totalAmount(): number - возвращает полную стоимость оплаты
- clearBasket(): void - полностью очищает корзину

### Слой представления

#### Класс Component
Класс представляет собой дженерик и является родительским классом для всех компонентов слоя представления. В качестве параметра дженерика он принимает тип объекта, который будет передан в метод render для отображения данных в компоненте. Конструктор принимает элемент разметки, который служит основным контейнером для компонента. Метод render отвечает за сохранение данных, переданных в качестве параметра, в полях компонента с использованием сеттеров и возвращает обновленный контейнер компонента.

#### Класс Modal
Реализует модальное окно со всеми базовыми свойствами и методами.\
Содержит `open` и `close` методы для взаимодействия с модальным окном.\
Устанавливает слушатели на клавиатуру, для закрытия модального окна с помощь Esc, на клик по оверлею и кнопку-крестик для закрытия модального окна.
- constructor(selector: string, events: IEvents) - конструктор принимает селектор, по которому можно идентифицировать модальное окно и экземпляр класса `EventEmitter` для возможности инициализаций событий.

Поля:
- modal: HTMLElement - элемент модального окна
- events: Ievents - брокер событий

### Класс ModalwithView
Расширяет класс Modal. Предназначен для реализации модального окна с подробным описанием товара. При открытии модального окна получает подробные данные выбранного товара.

Поля:
- productTitle: HTMLElement - элемент разметки с название товара
- productDescription: HTMLElement - элемент разметки с описанием товара
- productCategory: HTMLElement - элемент разметки с категорией товара
- productImage: HTMLImageElement - элемент разметки с изображением товара
- productPrice: HTMLElement - элемент разметки со стоимостью товара
- submitButton: HTMLButtonElement - кнопка добавления товара в корзину

Методы:
- setValid(isValid: boolean) void - изменяет активность кнопки подтверждения

### Класс ModalWithBasket
Расширяет класс Modal. Предназначен для реализации модального окна корзины. При открытии модального окна получает список интересующих товаров.

Поля:
- submitButton: HTMLButtonElement - кнопка оформления покупки 
- total: HTMLElement - элемент разметки с полной стоимостью всех товаров 
- basketList: HTMLElement - элемент разметки с полным списком товаров

### Класса ModalWithPlacing 
Расширяет класс Modal. Предназначен для реализации модального окна с формой, которая содержит поля ввода. При подтверждении инициализируется событие, передавая в него объект с данными из полей ввода формы. При изменении данных в полях ввода инициализируется событие изменения данных. Предоставляет методы для управления активностью кнопки.

Поля:
- submitButton: HTMLElementButton - кнопка подтверждения
- _form: HTMLFormElement - элемент формы
- formName: string - значение атрибута name формы
- inputs: NodeListOf<HTMLInputElement> - коллекция всех полей ввода формы
- errors: Record<string, HTMLElement> - объект хранящий все элементы вывода ошибок под полями формы с привязкой к атрибуту name input'ов

Методы:
- setValid(isValid: boolean): void - изменяет активность кнопки подтверждения
- getInputValues(): Record<string, string> - возвращает объект с данными из полей формы, где ключ - name input'а, значение - данные, который ввёл покупатель.
- setInputValues(data: Record<string, string>): void - принимает объект с данными для заполенения полей формы
- setError(data: { field: string, value: string, validInformation: string }): void - принимает объект с данными для отображения или сокрытия текстов ошибок под полями ввода
- showInputError(field: string, errorMessage: string): void - отображает полученный текст ошибки под указанным полем ввода
- hideInputError(field: string) - очищает текст ошибки под указанными полем ввода
- close(): void - расширяет родительский метод, при закрытии очищает поля формы и деактивирует кнопку.

#### Класс ModalWithCompleted
Расширяет класс Modal. Предназначен для реализации модального окна успешной покупки.

Поля:
- submitButton: HTMLElementButton - кнопка подтверждения
- total: HTMLElement - полная стоимость покупки

#### Класс Product
Отвечает за отображение товара, задавая в товаре данные названия, категории, изображения, стоимости и описания товара. Класс используется для отображения товаров на странице сайта. В конструктор класса передаётся DOM элемент темплейта, что позволяет при необходимости формировать товары разных вариантов вёрстки. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми генерируются соответствующие события.\
Поля класса содержат элементы разметки товара. Конструктор, помимо теймплейта принимает экземпляр класса `EventEmitter` для инициализаций событий.

Методы:
- render(productData: IProduct): HTMLElement - метод возвращает полностью заполненную карточку с установленными слушателями.
- get возвращает уникальный ID карточки.

#### Класс ProductList
Отвечает за отображение блока с товарами на главной странице. Конструктор принимает контейнер в котором размещается товар.

#### Класс Page
Принимает данные о количестве товаров в корзине для отображения счётчика.

### Слой коммуникации 

## Presenter
Код, описывающий взаимодействия данных и представления между собой находится в файле `index.ts`.
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в index.ts
В index.ts сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*
- `customer:set` - изменение данных покупателя
- `product:selected` - изменение данных товара для просмотра в модальном окне
- `product:previewClear` - необходима очистка данных товара для показа в модальном окне
- `products:changed` - изменение массива товаров в корзине

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `basket:open` - открытие модального окна корзины
- `product:select` - открытие модального окна товара
- `product:toBasket` - добавление товара в корзину
- `productInBasket:delete` - удаления товара из корзины
- `paymentMethod:select` - способ оплаты
- `emailAddress:input` - изменение данных в форме с почтой
- `deliveryAddress:input` - изменение данных в форме с адресом
- `phoneNumber:input` - изменение данных в форме с телефоном
- `orderInfo:submit` - отправка данных заказа из формы
- `customerInfo:submit` - отправка личных данных покупателя из формы
- `edit-emailAddress:validation` - валидация почты
- `edit-deliveryAddres:validation` - валидация адреса
- `edit-phoneNumber:validation` - валидация номера телефона

## Автор

- Github - [Whittnee.](https://github.com/Whittnee)
